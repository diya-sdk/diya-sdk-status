!function e(t,n,r){function s(o,u){if(!n[o]){if(!t[o]){var a="function"==typeof require&&require;if(!u&&a)return a(o,!0);if(i)return i(o,!0);var f=new Error("Cannot find module '"+o+"'");throw f.code="MODULE_NOT_FOUND",f}var l=n[o]={exports:{}};t[o][0].call(l.exports,function(e){var n=t[o][1][e];return s(n||e)},l,l.exports,e,t,n,r)}return n[o].exports}for(var i="function"==typeof require&&require,o=0;o<r.length;o++)s(r[o]);return s}({1:[function(require,module,exports){(function(process){function useColors(){return!("undefined"==typeof window||!window.process||"renderer"!==window.process.type)||("undefined"!=typeof document&&document.documentElement&&document.documentElement.style&&document.documentElement.style.WebkitAppearance||"undefined"!=typeof window&&window.console&&(window.console.firebug||window.console.exception&&window.console.table)||"undefined"!=typeof navigator&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/firefox\/(\d+)/)&&parseInt(RegExp.$1,10)>=31||"undefined"!=typeof navigator&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/applewebkit\/(\d+)/))}function formatArgs(args){var useColors=this.useColors;if(args[0]=(useColors?"%c":"")+this.namespace+(useColors?" %c":" ")+args[0]+(useColors?"%c ":" ")+"+"+exports.humanize(this.diff),useColors){var c="color: "+this.color;args.splice(1,0,c,"color: inherit");var index=0,lastC=0;args[0].replace(/%[a-zA-Z%]/g,function(match){"%%"!==match&&(index++,"%c"===match&&(lastC=index))}),args.splice(lastC,0,c)}}function log(){return"object"==typeof console&&console.log&&Function.prototype.apply.call(console.log,console,arguments)}function save(namespaces){try{null==namespaces?exports.storage.removeItem("debug"):exports.storage.debug=namespaces}catch(e){}}function load(){var r;try{r=exports.storage.debug}catch(e){}return!r&&void 0!==process&&"env"in process&&(r=process.env.DEBUG),r}exports=module.exports=require("./debug"),exports.log=log,exports.formatArgs=formatArgs,exports.save=save,exports.load=load,exports.useColors=useColors,exports.storage="undefined"!=typeof chrome&&void 0!==chrome.storage?chrome.storage.local:function(){try{return window.localStorage}catch(e){}}(),exports.colors=["lightseagreen","forestgreen","goldenrod","dodgerblue","darkorchid","crimson"],exports.formatters.j=function(v){try{return JSON.stringify(v)}catch(err){return"[UnexpectedJSONParseError]: "+err.message}},exports.enable(load())}).call(this,require("_process"))},{"./debug":2,_process:5}],2:[function(require,module,exports){function selectColor(namespace){var i,hash=0;for(i in namespace)hash=(hash<<5)-hash+namespace.charCodeAt(i),hash|=0;return exports.colors[Math.abs(hash)%exports.colors.length]}function createDebug(namespace){function debug(){if(debug.enabled){var self=debug,curr=+new Date,ms=curr-(prevTime||curr);self.diff=ms,self.prev=prevTime,self.curr=curr,prevTime=curr;for(var args=new Array(arguments.length),i=0;i<args.length;i++)args[i]=arguments[i];args[0]=exports.coerce(args[0]),"string"!=typeof args[0]&&args.unshift("%O");var index=0;args[0]=args[0].replace(/%([a-zA-Z%])/g,function(match,format){if("%%"===match)return match;index++;var formatter=exports.formatters[format];if("function"==typeof formatter){var val=args[index];match=formatter.call(self,val),args.splice(index,1),index--}return match}),exports.formatArgs.call(self,args);(debug.log||exports.log||console.log.bind(console)).apply(self,args)}}return debug.namespace=namespace,debug.enabled=exports.enabled(namespace),debug.useColors=exports.useColors(),debug.color=selectColor(namespace),"function"==typeof exports.init&&exports.init(debug),debug}function enable(namespaces){exports.save(namespaces),exports.names=[],exports.skips=[];for(var split=("string"==typeof namespaces?namespaces:"").split(/[\s,]+/),len=split.length,i=0;i<len;i++)split[i]&&(namespaces=split[i].replace(/\*/g,".*?"),"-"===namespaces[0]?exports.skips.push(new RegExp("^"+namespaces.substr(1)+"$")):exports.names.push(new RegExp("^"+namespaces+"$")))}function disable(){exports.enable("")}function enabled(name){var i,len;for(i=0,len=exports.skips.length;i<len;i++)if(exports.skips[i].test(name))return!1;for(i=0,len=exports.names.length;i<len;i++)if(exports.names[i].test(name))return!0;return!1}function coerce(val){return val instanceof Error?val.stack||val.message:val}exports=module.exports=createDebug.debug=createDebug.default=createDebug,exports.coerce=coerce,exports.disable=disable,exports.enable=enable,exports.enabled=enabled,exports.humanize=require("ms"),exports.names=[],exports.skips=[],exports.formatters={};var prevTime},{ms:4}],3:[function(require,module,exports){"use strict";function Events(){}function EE(fn,context,once){this.fn=fn,this.context=context,this.once=once||!1}function EventEmitter(){this._events=new Events,this._eventsCount=0}var has=Object.prototype.hasOwnProperty,prefix="~";Object.create&&(Events.prototype=Object.create(null),(new Events).__proto__||(prefix=!1)),EventEmitter.prototype.eventNames=function(){var events,name,names=[];if(0===this._eventsCount)return names;for(name in events=this._events)has.call(events,name)&&names.push(prefix?name.slice(1):name);return Object.getOwnPropertySymbols?names.concat(Object.getOwnPropertySymbols(events)):names},EventEmitter.prototype.listeners=function(event,exists){var evt=prefix?prefix+event:event,available=this._events[evt];if(exists)return!!available;if(!available)return[];if(available.fn)return[available.fn];for(var i=0,l=available.length,ee=new Array(l);i<l;i++)ee[i]=available[i].fn;return ee},EventEmitter.prototype.emit=function(event,a1,a2,a3,a4,a5){var evt=prefix?prefix+event:event;if(!this._events[evt])return!1;var args,i,listeners=this._events[evt],len=arguments.length;if(listeners.fn){switch(listeners.once&&this.removeListener(event,listeners.fn,void 0,!0),len){case 1:return listeners.fn.call(listeners.context),!0;case 2:return listeners.fn.call(listeners.context,a1),!0;case 3:return listeners.fn.call(listeners.context,a1,a2),!0;case 4:return listeners.fn.call(listeners.context,a1,a2,a3),!0;case 5:return listeners.fn.call(listeners.context,a1,a2,a3,a4),!0;case 6:return listeners.fn.call(listeners.context,a1,a2,a3,a4,a5),!0}for(i=1,args=new Array(len-1);i<len;i++)args[i-1]=arguments[i];listeners.fn.apply(listeners.context,args)}else{var j,length=listeners.length;for(i=0;i<length;i++)switch(listeners[i].once&&this.removeListener(event,listeners[i].fn,void 0,!0),len){case 1:listeners[i].fn.call(listeners[i].context);break;case 2:listeners[i].fn.call(listeners[i].context,a1);break;case 3:listeners[i].fn.call(listeners[i].context,a1,a2);break;case 4:listeners[i].fn.call(listeners[i].context,a1,a2,a3);break;default:if(!args)for(j=1,args=new Array(len-1);j<len;j++)args[j-1]=arguments[j];listeners[i].fn.apply(listeners[i].context,args)}}return!0},EventEmitter.prototype.on=function(event,fn,context){var listener=new EE(fn,context||this),evt=prefix?prefix+event:event;return this._events[evt]?this._events[evt].fn?this._events[evt]=[this._events[evt],listener]:this._events[evt].push(listener):(this._events[evt]=listener,this._eventsCount++),this},EventEmitter.prototype.once=function(event,fn,context){var listener=new EE(fn,context||this,!0),evt=prefix?prefix+event:event;return this._events[evt]?this._events[evt].fn?this._events[evt]=[this._events[evt],listener]:this._events[evt].push(listener):(this._events[evt]=listener,this._eventsCount++),this},EventEmitter.prototype.removeListener=function(event,fn,context,once){var evt=prefix?prefix+event:event;if(!this._events[evt])return this;if(!fn)return 0==--this._eventsCount?this._events=new Events:delete this._events[evt],this;var listeners=this._events[evt];if(listeners.fn)listeners.fn!==fn||once&&!listeners.once||context&&listeners.context!==context||(0==--this._eventsCount?this._events=new Events:delete this._events[evt]);else{for(var i=0,events=[],length=listeners.length;i<length;i++)(listeners[i].fn!==fn||once&&!listeners[i].once||context&&listeners[i].context!==context)&&events.push(listeners[i]);events.length?this._events[evt]=1===events.length?events[0]:events:0==--this._eventsCount?this._events=new Events:delete this._events[evt]}return this},EventEmitter.prototype.removeAllListeners=function(event){var evt;return event?(evt=prefix?prefix+event:event,this._events[evt]&&(0==--this._eventsCount?this._events=new Events:delete this._events[evt])):(this._events=new Events,this._eventsCount=0),this},EventEmitter.prototype.off=EventEmitter.prototype.removeListener,EventEmitter.prototype.addListener=EventEmitter.prototype.on,EventEmitter.prototype.setMaxListeners=function(){return this},EventEmitter.prefixed=prefix,EventEmitter.EventEmitter=EventEmitter,void 0!==module&&(module.exports=EventEmitter)},{}],4:[function(require,module,exports){function parse(str){if(str=String(str),!(str.length>100)){var match=/^((?:\d+)?\.?\d+) *(milliseconds?|msecs?|ms|seconds?|secs?|s|minutes?|mins?|m|hours?|hrs?|h|days?|d|years?|yrs?|y)?$/i.exec(str);if(match){var n=parseFloat(match[1]);switch((match[2]||"ms").toLowerCase()){case"years":case"year":case"yrs":case"yr":case"y":return n*y;case"days":case"day":case"d":return n*d;case"hours":case"hour":case"hrs":case"hr":case"h":return n*h;case"minutes":case"minute":case"mins":case"min":case"m":return n*m;case"seconds":case"second":case"secs":case"sec":case"s":return n*s;case"milliseconds":case"millisecond":case"msecs":case"msec":case"ms":return n;default:return}}}}function fmtShort(ms){return ms>=d?Math.round(ms/d)+"d":ms>=h?Math.round(ms/h)+"h":ms>=m?Math.round(ms/m)+"m":ms>=s?Math.round(ms/s)+"s":ms+"ms"}function fmtLong(ms){return plural(ms,d,"day")||plural(ms,h,"hour")||plural(ms,m,"minute")||plural(ms,s,"second")||ms+" ms"}function plural(ms,n,name){if(!(ms<n))return ms<1.5*n?Math.floor(ms/n)+" "+name:Math.ceil(ms/n)+" "+name+"s"}var s=1e3,m=60*s,h=60*m,d=24*h,y=365.25*d;module.exports=function(val,options){options=options||{};var type=typeof val;if("string"===type&&val.length>0)return parse(val);if("number"===type&&!1===isNaN(val))return options.long?fmtLong(val):fmtShort(val);throw new Error("val is not a non-empty string or a valid number. val="+JSON.stringify(val))}},{}],5:[function(require,module,exports){function defaultSetTimout(){throw new Error("setTimeout has not been defined")}function defaultClearTimeout(){throw new Error("clearTimeout has not been defined")}function runTimeout(fun){if(cachedSetTimeout===setTimeout)return setTimeout(fun,0);if((cachedSetTimeout===defaultSetTimout||!cachedSetTimeout)&&setTimeout)return cachedSetTimeout=setTimeout,setTimeout(fun,0);try{return cachedSetTimeout(fun,0)}catch(e){try{return cachedSetTimeout.call(null,fun,0)}catch(e){return cachedSetTimeout.call(this,fun,0)}}}function runClearTimeout(marker){if(cachedClearTimeout===clearTimeout)return clearTimeout(marker);if((cachedClearTimeout===defaultClearTimeout||!cachedClearTimeout)&&clearTimeout)return cachedClearTimeout=clearTimeout,clearTimeout(marker);try{return cachedClearTimeout(marker)}catch(e){try{return cachedClearTimeout.call(null,marker)}catch(e){return cachedClearTimeout.call(this,marker)}}}function cleanUpNextTick(){draining&&currentQueue&&(draining=!1,currentQueue.length?queue=currentQueue.concat(queue):queueIndex=-1,queue.length&&drainQueue())}function drainQueue(){if(!draining){var timeout=runTimeout(cleanUpNextTick);draining=!0;for(var len=queue.length;len;){for(currentQueue=queue,queue=[];++queueIndex<len;)currentQueue&&currentQueue[queueIndex].run();queueIndex=-1,len=queue.length}currentQueue=null,draining=!1,runClearTimeout(timeout)}}function Item(fun,array){this.fun=fun,this.array=array}function noop(){}var cachedSetTimeout,cachedClearTimeout,process=module.exports={};!function(){try{cachedSetTimeout="function"==typeof setTimeout?setTimeout:defaultSetTimout}catch(e){cachedSetTimeout=defaultSetTimout}try{cachedClearTimeout="function"==typeof clearTimeout?clearTimeout:defaultClearTimeout}catch(e){cachedClearTimeout=defaultClearTimeout}}();var currentQueue,queue=[],draining=!1,queueIndex=-1;process.nextTick=function(fun){var args=new Array(arguments.length-1);if(arguments.length>1)for(var i=1;i<arguments.length;i++)args[i-1]=arguments[i];queue.push(new Item(fun,args)),1!==queue.length||draining||runTimeout(drainQueue)},Item.prototype.run=function(){this.fun.apply(null,this.array)},process.title="browser",process.browser=!0,process.env={},process.argv=[],process.version="",process.versions={},process.on=noop,process.addListener=noop,process.once=noop,process.off=noop,process.removeListener=noop,process.removeAllListeners=noop,process.emit=noop,process.prependListener=noop,process.prependOnceListener=noop,process.listeners=function(name){return[]},process.binding=function(name){throw new Error("process.binding is not supported")},process.cwd=function(){return"/"},process.chdir=function(dir){throw new Error("process.chdir is not supported")},process.umask=function(){return 0}},{}],6:[function(require,module,exports){"function"==typeof Object.create?module.exports=function(ctor,superCtor){ctor.super_=superCtor,ctor.prototype=Object.create(superCtor.prototype,{constructor:{value:ctor,enumerable:!1,writable:!0,configurable:!0}})}:module.exports=function(ctor,superCtor){ctor.super_=superCtor;var TempCtor=function(){};TempCtor.prototype=superCtor.prototype,ctor.prototype=new TempCtor,ctor.prototype.constructor=ctor}},{}],7:[function(require,module,exports){module.exports=function(arg){return arg&&"object"==typeof arg&&"function"==typeof arg.copy&&"function"==typeof arg.fill&&"function"==typeof arg.readUInt8}},{}],8:[function(require,module,exports){(function(process,global){function inspect(obj,opts){var ctx={seen:[],stylize:stylizeNoColor};return arguments.length>=3&&(ctx.depth=arguments[2]),arguments.length>=4&&(ctx.colors=arguments[3]),isBoolean(opts)?ctx.showHidden=opts:opts&&exports._extend(ctx,opts),isUndefined(ctx.showHidden)&&(ctx.showHidden=!1),isUndefined(ctx.depth)&&(ctx.depth=2),isUndefined(ctx.colors)&&(ctx.colors=!1),isUndefined(ctx.customInspect)&&(ctx.customInspect=!0),ctx.colors&&(ctx.stylize=stylizeWithColor),formatValue(ctx,obj,ctx.depth)}function stylizeWithColor(str,styleType){var style=inspect.styles[styleType];return style?"["+inspect.colors[style][0]+"m"+str+"["+inspect.colors[style][1]+"m":str}function stylizeNoColor(str,styleType){return str}function arrayToHash(array){var hash={};return array.forEach(function(val,idx){hash[val]=!0}),hash}function formatValue(ctx,value,recurseTimes){if(ctx.customInspect&&value&&isFunction(value.inspect)&&value.inspect!==exports.inspect&&(!value.constructor||value.constructor.prototype!==value)){var ret=value.inspect(recurseTimes,ctx);return isString(ret)||(ret=formatValue(ctx,ret,recurseTimes)),ret}var primitive=formatPrimitive(ctx,value);if(primitive)return primitive;var keys=Object.keys(value),visibleKeys=arrayToHash(keys);if(ctx.showHidden&&(keys=Object.getOwnPropertyNames(value)),isError(value)&&(keys.indexOf("message")>=0||keys.indexOf("description")>=0))return formatError(value);if(0===keys.length){if(isFunction(value)){var name=value.name?": "+value.name:"";return ctx.stylize("[Function"+name+"]","special")}if(isRegExp(value))return ctx.stylize(RegExp.prototype.toString.call(value),"regexp");if(isDate(value))return ctx.stylize(Date.prototype.toString.call(value),"date");if(isError(value))return formatError(value)}var base="",array=!1,braces=["{","}"];if(isArray(value)&&(array=!0,braces=["[","]"]),isFunction(value)){base=" [Function"+(value.name?": "+value.name:"")+"]"}if(isRegExp(value)&&(base=" "+RegExp.prototype.toString.call(value)),isDate(value)&&(base=" "+Date.prototype.toUTCString.call(value)),isError(value)&&(base=" "+formatError(value)),0===keys.length&&(!array||0==value.length))return braces[0]+base+braces[1];if(recurseTimes<0)return isRegExp(value)?ctx.stylize(RegExp.prototype.toString.call(value),"regexp"):ctx.stylize("[Object]","special");ctx.seen.push(value);var output;return output=array?formatArray(ctx,value,recurseTimes,visibleKeys,keys):keys.map(function(key){return formatProperty(ctx,value,recurseTimes,visibleKeys,key,array)}),ctx.seen.pop(),reduceToSingleString(output,base,braces)}function formatPrimitive(ctx,value){if(isUndefined(value))return ctx.stylize("undefined","undefined");if(isString(value)){var simple="'"+JSON.stringify(value).replace(/^"|"$/g,"").replace(/'/g,"\\'").replace(/\\"/g,'"')+"'";return ctx.stylize(simple,"string")}return isNumber(value)?ctx.stylize(""+value,"number"):isBoolean(value)?ctx.stylize(""+value,"boolean"):isNull(value)?ctx.stylize("null","null"):void 0}function formatError(value){return"["+Error.prototype.toString.call(value)+"]"}function formatArray(ctx,value,recurseTimes,visibleKeys,keys){for(var output=[],i=0,l=value.length;i<l;++i)hasOwnProperty(value,String(i))?output.push(formatProperty(ctx,value,recurseTimes,visibleKeys,String(i),!0)):output.push("");return keys.forEach(function(key){key.match(/^\d+$/)||output.push(formatProperty(ctx,value,recurseTimes,visibleKeys,key,!0))}),output}function formatProperty(ctx,value,recurseTimes,visibleKeys,key,array){var name,str,desc;if(desc=Object.getOwnPropertyDescriptor(value,key)||{value:value[key]},desc.get?str=desc.set?ctx.stylize("[Getter/Setter]","special"):ctx.stylize("[Getter]","special"):desc.set&&(str=ctx.stylize("[Setter]","special")),hasOwnProperty(visibleKeys,key)||(name="["+key+"]"),str||(ctx.seen.indexOf(desc.value)<0?(str=isNull(recurseTimes)?formatValue(ctx,desc.value,null):formatValue(ctx,desc.value,recurseTimes-1),str.indexOf("\n")>-1&&(str=array?str.split("\n").map(function(line){return"  "+line}).join("\n").substr(2):"\n"+str.split("\n").map(function(line){return"   "+line}).join("\n"))):str=ctx.stylize("[Circular]","special")),isUndefined(name)){if(array&&key.match(/^\d+$/))return str;name=JSON.stringify(""+key),name.match(/^"([a-zA-Z_][a-zA-Z_0-9]*)"$/)?(name=name.substr(1,name.length-2),name=ctx.stylize(name,"name")):(name=name.replace(/'/g,"\\'").replace(/\\"/g,'"').replace(/(^"|"$)/g,"'"),name=ctx.stylize(name,"string"))}return name+": "+str}function reduceToSingleString(output,base,braces){var numLinesEst=0;return output.reduce(function(prev,cur){return numLinesEst++,cur.indexOf("\n")>=0&&numLinesEst++,prev+cur.replace(/\u001b\[\d\d?m/g,"").length+1},0)>60?braces[0]+(""===base?"":base+"\n ")+" "+output.join(",\n  ")+" "+braces[1]:braces[0]+base+" "+output.join(", ")+" "+braces[1]}function isArray(ar){return Array.isArray(ar)}function isBoolean(arg){return"boolean"==typeof arg}function isNull(arg){return null===arg}function isNullOrUndefined(arg){return null==arg}function isNumber(arg){return"number"==typeof arg}function isString(arg){return"string"==typeof arg}function isSymbol(arg){return"symbol"==typeof arg}function isUndefined(arg){return void 0===arg}function isRegExp(re){return isObject(re)&&"[object RegExp]"===objectToString(re)}function isObject(arg){return"object"==typeof arg&&null!==arg}function isDate(d){return isObject(d)&&"[object Date]"===objectToString(d)}function isError(e){return isObject(e)&&("[object Error]"===objectToString(e)||e instanceof Error)}function isFunction(arg){return"function"==typeof arg}function isPrimitive(arg){return null===arg||"boolean"==typeof arg||"number"==typeof arg||"string"==typeof arg||"symbol"==typeof arg||void 0===arg}function objectToString(o){return Object.prototype.toString.call(o)}function pad(n){return n<10?"0"+n.toString(10):n.toString(10)}function timestamp(){var d=new Date,time=[pad(d.getHours()),pad(d.getMinutes()),pad(d.getSeconds())].join(":");return[d.getDate(),months[d.getMonth()],time].join(" ")}function hasOwnProperty(obj,prop){return Object.prototype.hasOwnProperty.call(obj,prop)}exports.format=function(f){if(!isString(f)){for(var objects=[],i=0;i<arguments.length;i++)objects.push(inspect(arguments[i]));return objects.join(" ")}for(var i=1,args=arguments,len=args.length,str=String(f).replace(/%[sdj%]/g,function(x){if("%%"===x)return"%";if(i>=len)return x;switch(x){case"%s":return String(args[i++]);case"%d":return Number(args[i++]);case"%j":try{return JSON.stringify(args[i++])}catch(_){return"[Circular]"}default:return x}}),x=args[i];i<len;x=args[++i])isNull(x)||!isObject(x)?str+=" "+x:str+=" "+inspect(x);return str},exports.deprecate=function(fn,msg){function deprecated(){if(!warned){if(process.throwDeprecation)throw new Error(msg);process.traceDeprecation?console.trace(msg):console.error(msg),warned=!0}return fn.apply(this,arguments)}if(isUndefined(global.process))return function(){return exports.deprecate(fn,msg).apply(this,arguments)};if(!0===process.noDeprecation)return fn;var warned=!1;return deprecated};var debugEnviron,debugs={};exports.debuglog=function(set){if(isUndefined(debugEnviron)&&(debugEnviron=process.env.NODE_DEBUG||""),set=set.toUpperCase(),!debugs[set])if(new RegExp("\\b"+set+"\\b","i").test(debugEnviron)){var pid=process.pid;debugs[set]=function(){var msg=exports.format.apply(exports,arguments);console.error("%s %d: %s",set,pid,msg)}}else debugs[set]=function(){};return debugs[set]},exports.inspect=inspect,inspect.colors={bold:[1,22],italic:[3,23],underline:[4,24],inverse:[7,27],white:[37,39],grey:[90,39],black:[30,39],blue:[34,39],cyan:[36,39],green:[32,39],magenta:[35,39],red:[31,39],yellow:[33,39]},inspect.styles={special:"cyan",number:"yellow",boolean:"yellow",undefined:"grey",null:"bold",string:"green",date:"magenta",regexp:"red"},exports.isArray=isArray,exports.isBoolean=isBoolean,exports.isNull=isNull,exports.isNullOrUndefined=isNullOrUndefined,exports.isNumber=isNumber,exports.isString=isString,exports.isSymbol=isSymbol,exports.isUndefined=isUndefined,exports.isRegExp=isRegExp,exports.isObject=isObject,exports.isDate=isDate,exports.isError=isError,exports.isFunction=isFunction,exports.isPrimitive=isPrimitive,exports.isBuffer=require("./support/isBuffer");var months=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"];exports.log=function(){console.log("%s - %s",timestamp(),exports.format.apply(exports,arguments))},exports.inherits=require("inherits"),exports._extend=function(origin,add){if(!add||!isObject(add))return origin;for(var keys=Object.keys(add),i=keys.length;i--;)origin[keys[i]]=add[keys[i]];return origin}}).call(this,require("_process"),"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"./support/isBuffer":7,_process:5,inherits:6}],9:[function(require,module,exports){"use strict";!function(){function Status(selector){return this.selector=selector,this._coder=selector.encode(),this.watchers=[],this.robotModel=[],this}var debug=require("debug")("status"),Watcher=require("./watcher.js");if("undefined"==typeof window)var Promise=require("bluebird");else var Promise=window.Promise;var DiyaSelector=d1.DiyaSelector,Logger=(require("util"),{log:function(message){console.log(message)},error:function(message){console.error(message)}});Status.prototype.watch=function(options,callback){var _this=this;if(null==callback||"function"!=typeof callback)return null;var watcher=new Watcher(this.selector,options);return this.watchers.push(watcher),watcher.on("data",function(data){debug(data),callback(_this._getRobotModelFromRecv2(data.parts,data.robotId,data.robotName),data.peerId)}),watcher.on("stop",this._removeWatcher),watcher},Status.prototype._removeWatcher=function(watcher){this.watchers.find(function(el,id,watchers){return watcher===el&&(watchers.splice(id,1),!0)})},Status.prototype.closeSubscriptions=function(){console.warn("Deprecated function use stopWatchers instead"),this.stopWatchers()},Status.prototype.stopWatchers=function(){var _this2=this;this.watchers.forEach(function(watcher){watcher.removeListener("stop",_this2._removeWatcher),watcher.stop()}),this.watchers=[]},Status.prototype._getRobotModelFromRecv2=function(data,robotId,robotName){var _this3=this;null==this.robotModel&&(this.robotModel=[]),null!=this.robotModel[robotId]&&(this.robotModel[robotId].parts={}),null==this.robotModel[robotId]&&(this.robotModel[robotId]={}),this.robotModel[robotId]={robot:{name:robotName}},this.robotModel[robotId].parts={};var rParts=this.robotModel[robotId].parts;return data.forEach(function(d){var partId=d[0],category=d[1],partName=d[2],label=d[3],time=d[4],code=d[5],codeRef=d[6],msg=d[7],critLevel=d[8],description=d[9];null==rParts[partId]&&(rParts[partId]={}),rParts[partId].category=category,rParts[partId].name=partName.toLowerCase(),rParts[partId].label=label,null==rParts[partId].errorList&&(rParts[partId].errorList={}),null==rParts[partId].errorList[codeRef]&&(rParts[partId].errorList[codeRef]={msg:msg,critLevel:critLevel,description:description});var evts_tmp={time:_this3._coder.from(time),code:_this3._coder.from(code),codeRef:_this3._coder.from(codeRef)};null==rParts[partId].evts&&(rParts[partId].evts=[]),rParts[partId].evts.push(evts_tmp)}),this.robotModel},DiyaSelector.prototype.Status=function(){return new Status(this)},DiyaSelector.prototype.setStatus=function(robotName,partName,code,source,callback){var _this4=this;return Promise.try(function(_){var objectPath="/fr/partnering/Status/Robots/"+_this4.splitAndCamelCase(robotName,"-")+"/Parts/"+partName;_this4.request({service:"status",func:"SetPart",obj:{interface:"fr.partnering.Status.Part",path:objectPath},data:{code:code,source:1|source}},_this4.onSetPart.bind(_this4,callback))}).catch(function(err){Logger.error(err)})},Status.prototype.onSetPart=function(callback,peerId,err,data){null!=err?"function"==typeof callback&&callback(!1):"function"==typeof callback&&callback(!0)},Status.prototype.getStatus=function(robotName,partName,callback){var _this5=this;return Promise.try(function(_){_this5.selector.request({service:"status",func:"GetManagedObjects",obj:{interface:"org.freedesktop.DBus.ObjectManager"}},_this5.onGetManagedObjectsGetStatus.bind(_this5,robotName,partName,callback))}).catch(function(err){Logger.error(err)})},Status.prototype.onGetManagedObjectsGetStatus=function(robotName,partName,callback,peerId,err,data){var objectPathRobot="/fr/partnering/Status/Robots/"+this.splitAndCamelCase(robotName,"-"),objectPathPart="/fr/partnering/Status/Robots/"+this.splitAndCamelCase(robotName,"-")+"/Parts/"+partName,robotId=data[objectPathRobot]["fr.partnering.Status.Robot"].RobotId;this.selector.request({service:"status",func:"GetPart",obj:{interface:"fr.partnering.Status.Part",path:objectPathPart}},this.onGetPart.bind(this,robotId,robotName,callback))},Status.prototype.onGetPart=function(robotId,robotName,callback,peerId,err,data){var sendData=[];sendData.push(data),this._getRobotModelFromRecv2(sendData,robotId,robotName),null!=err?"function"==typeof callback&&callback(-1):"function"==typeof callback&&callback(this.robotModel)},Status.prototype.getAllStatuses=function(robotName,callback){this.selector.request({service:"status",func:"GetManagedObjects",obj:{interface:"org.freedesktop.DBus.ObjectManager"}},this.onGetManagedObjectsGetAllStatuses.bind(this,robotName,callback))},Status.prototype.onGetManagedObjectsGetAllStatuses=function(robotName,callback,peerId,err,data){var objectPath="/fr/partnering/Status/Robots/"+this.splitAndCamelCase(robotName,"-");if(null!=data[objectPath])if(null!=data[objectPath]["fr.partnering.Status.Robot"]){var robotId=data[objectPath]["fr.partnering.Status.Robot"].RobotId;this.selector.request({service:"status",func:"GetAllParts",obj:{interface:"fr.partnering.Status.Robot",path:objectPath}},this.onGetAllParts.bind(this,robotId,robotName,callback))}else Logger.error("Interface fr.partnering.Status.Robot doesn't exist!");else Logger.error("ObjectPath "+objectPath+" doesn't exist!")},Status.prototype.onGetAllParts=function(robotId,robotName,callback,peerId,err,data){if(null!=err)throw"function"==typeof callback&&callback(-1),new Error(err);this._getRobotModelFromRecv2(data,robotId,robotName),"function"==typeof callback&&callback(this.robotModel)},Status.prototype.splitAndCamelCase=function(inString,delimiter){var arraySplitString=inString.split(delimiter),outCamelString="";return arraySplitString.forEach(function(str){outCamelString+=str.charAt(0).toUpperCase()+str.substring(1)}),outCamelString}}()},{"./watcher.js":10,bluebird:void 0,debug:1,util:8}],10:[function(require,module,exports){"use strict";function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}function _possibleConstructorReturn(self,call){if(!self)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!call||"object"!=typeof call&&"function"!=typeof call?self:call}function _inherits(subClass,superClass){if("function"!=typeof superClass&&null!==superClass)throw new TypeError("Super expression must either be null or a function, not "+typeof superClass);subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:!1,writable:!0,configurable:!0}}),superClass&&(Object.setPrototypeOf?Object.setPrototypeOf(subClass,superClass):subClass.__proto__=superClass)}var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||!1,descriptor.configurable=!0,"value"in descriptor&&(descriptor.writable=!0),Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){return protoProps&&defineProperties(Constructor.prototype,protoProps),staticProps&&defineProperties(Constructor,staticProps),Constructor}}(),EventEmitter=require("eventemitter3"),debug=require("debug")("status:watcher"),debugError=require("debug")("status:watcher:errors"),StopCondition=function(_Error){function StopCondition(msg){_classCallCheck(this,StopCondition);var _this=_possibleConstructorReturn(this,(StopCondition.__proto__||Object.getPrototypeOf(StopCondition)).call(this,msg));return _this.name="StopCondition",_this}return _inherits(StopCondition,_Error),StopCondition}(Error),Watcher=function(_EventEmitter){function Watcher(selector,options){_classCallCheck(this,Watcher);var _this2=_possibleConstructorReturn(this,(Watcher.__proto__||Object.getPrototypeOf(Watcher)).call(this));return _this2.selector=selector,_this2.subscriptions=[],_this2.state="running",_this2.reconnectionPeriod=0,_this2.maxReconnectionPeriod=6e4,_this2.selector.setMaxListeners(0),_this2.selector._connection.setMaxListeners(0),null==options.signal&&(options.signal="StatusesBuffered"),_this2._statusesDictionary={},debug(options),_this2.watch(options),_this2}return _inherits(Watcher,_EventEmitter),_createClass(Watcher,[{key:"watch",value:function(options){var _this3=this;debug("in watch"),new Promise(function(resolve,reject){_this3.selector.request({service:"status",func:"GetManagedObjects",obj:{interface:"org.freedesktop.DBus.ObjectManager"}},function(peerId,err,data){if(null!=err)return void reject(err);if("stopped"===_this3.state)return void reject(new StopCondition);debug("Request:emitData"),debug(data),data=_this3._parseGetManagedObjectsData(data),debug(data);for(var deviceName in data.devices){var device=data.devices[deviceName];if(0===device.parts.length)return void reject("Error: No part yet");var dataToEmit={parts:device.parts,robotId:device.robotId,robotName:device.robotName,peerId:peerId};_this3.emit("data",dataToEmit)}resolve()})}).then(function(){return new Promise(function(resolve,reject){_this3.selector.request({service:"status",func:"Get",obj:{interface:"org.freedesktop.DBus.Properties",path:"/fr/partnering/Status"},data:{interface_name:"fr.partnering.Status",property_name:"StatusesDictionary"}},function(peerId,err,data){return null!=err?void reject(err):"stopped"===_this3.state?void reject(new StopCondition):null==data?void reject("No StatusesDictionary data"):(_this3._statusesDictionary=data,void resolve())})})}).then(function(){return debug("Subscribing"),new Promise(function(resolve,reject){
var subscription=_this3.selector.subscribe({service:"status",func:options.signal},function(peerId,err,data){if(null!=err)return void reject(err);if(null!=data){data=_this3._parseStatusChangedData(data[0]);for(var deviceName in data.devices){var device=data.devices[deviceName],dataToEmit={parts:device.parts,robotId:device.robotId,robotName:device.robotName,peerId:peerId};_this3.emit("data",dataToEmit)}}_this3.reconnectionPeriod=0,resolve()});_this3.subscriptions.push(subscription)})}).catch(function(err){"StopCondition"!==err.name&&(debugError(err),_this3._closeSubscriptions(),_this3.reconnectionPeriod=_this3.reconnectionPeriod+1e3,_this3.reconnectionPeriod>_this3.maxReconnectionPeriod&&(_this3.reconnectionPeriod=_this3.maxReconnectionPeriod),_this3.watchTentative=setTimeout(function(){_this3.watch(options)},_this3.reconnectionPeriod))})}},{key:"_parseGetManagedObjectsData",value:function(data){var parsedData={devices:{}};if(null==data)return parsedData;for(var path in data){var obj=data[path],splitPath=path.split("/");if(6===splitPath.length){for(var iface in obj)if("fr.partnering.Status.Robot"===iface){var device=obj[iface],robotName=splitPath[5].toLowerCase(),selDevice=parsedData.devices[robotName];null==selDevice&&(selDevice={parts:[]},parsedData.devices[robotName]=selDevice),selDevice.robotName=device.RobotName,selDevice.robotId=device.RobotId}}else if(8===splitPath.length){for(var _iface in obj)if("fr.partnering.Status.Part"===_iface){var part=obj[_iface],_robotName=splitPath[5].toLowerCase(),_selDevice=parsedData.devices[_robotName];null==_selDevice&&(_selDevice={parts:[]},parsedData.devices[_robotName]=_selDevice);var newPart=[];newPart[0]=part.PartId,newPart[1]=part.Category,newPart[2]=part.PartName,newPart[3]="",newPart[4]=part.Time,newPart[5]=part.Code,newPart[6]=part.CodeRef,newPart[7]=part.Msg,newPart[8]=part.CritLevel,newPart[9]="",_selDevice.parts.push(newPart)}}else debugError("Undefined path format")}return parsedData}},{key:"_parseStatusChangedData",value:function(data){var _this4=this,parsedData={};return data.forEach(function(event){var robotName=event[0],robotId=event[1],time=event[2],statusEventId=event[3],code=event[4],robotNameLowerCase=robotName.toLowerCase();if(_this4._statusesDictionary[statusEventId][0]!==statusEventId)return void console.error("Malformed statuses dictionary");var partId=_this4._statusesDictionary[statusEventId][1],codeRef=_this4._statusesDictionary[statusEventId][2],partName=_this4._statusesDictionary[statusEventId][3],category=_this4._statusesDictionary[statusEventId][4],msg=_this4._statusesDictionary[statusEventId][5],critLevel=_this4._statusesDictionary[statusEventId][6];null==parsedData.devices&&(parsedData.devices=[]),null==parsedData.devices[robotNameLowerCase]&&(parsedData.devices[robotNameLowerCase]={}),parsedData.devices[robotNameLowerCase].robotId=robotId,parsedData.devices[robotNameLowerCase].robotName=robotName,null==parsedData.devices[robotNameLowerCase].parts&&(parsedData.devices[robotNameLowerCase].parts=[]);var newPart=[];newPart[0]=partId,newPart[1]=category,newPart[2]=partName,newPart[3]="",newPart[4]=time,newPart[5]=code,newPart[6]=codeRef,newPart[7]=msg,newPart[8]=critLevel,newPart[9]="",parsedData.devices[robotNameLowerCase].parts.push(newPart)}),parsedData}},{key:"_closeSubscriptions",value:function(){debug("In closeSubscription");for(var i in this.subscriptions)this.subscriptions[i].close();this.subscriptions=[]}},{key:"stop",value:function(){debug("In stop"),this.state="stopped",null!=this.watchTentative&&clearTimeout(this.watchTentative),this._closeSubscriptions(),this.emit("stop"),this.removeAllListeners()}}]),Watcher}(EventEmitter);module.exports=Watcher},{debug:1,eventemitter3:3}]},{},[9]);
